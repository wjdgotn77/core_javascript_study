# 콜백 함수

## 콜백 함수란?

다른 코드에 **인자**로 넘겨줌으로써 그 **제어권**도 함께 위임한 함수이다.

### 예시

김콜백이라는 사람이 맛집에 가려고 한다.  
김콜백이라는 사람과 식당(제어권을 넘겨받은 함수)이 존재하는데, 이 때 맛집은 대기가 많으므로 대기자 명단에 이름을 적고 주변을 돌아다니며 구경한다. (다른 코드를 처리함)  
구경하다가 식당(제어권을 넘겨받은 함수)에서 차례가 되었다고 전화가 온다.  
전화를 받는 시점이 콜백 함수가 호출되는 시점이다.

<br>

## 다른 코드가 콜백 함수로부터 제어권을 넘겨받을 경우

### 콜백 함수를 호출하는 시점을 스스로 판단하여 실행한다.

```javascript
var count = 0;
var cbFunc = function () {
  console.log(count);
  if (++count > 4) clearInterval(timer);
};

var timer = setInterval(cbFunc, 300);
// 호출 주체와 제어권이 setInterval에 있는 상태

// 0 0.3초
// 1 0.6초
// 2 0.9초
// 3 1.2초
// 4 1.5초
```

### 콜백 함수를 호출할 때 인자로 넘겨줄 값들 및 그 순서가 정해져 있다.

- map, forEach, filter, reduce ...

콜백 함수의 제어권을 넘겨받은 코드는 콜백 함수를 호출할 때 인자에 어떤 값들을 어떤 순서로 넘길 것인지에 대한 제어권을 가진다.

### 콜백 함수의 this가 무엇을 바라보도록 할지

1. 정해져 있는 경우도 있고
2. 정할 수도 있으며(bind 메서드)
3. 정하지 않으면 전역객체(window)를 바라본다.

> 예시) **addEventListener** 💥  
> addEventListener에서는 내부에서 콜백 함수를 호출할 때 call 메서드의 첫 번째 인자에 addEventListener의 this를 그대로 넘기도록 정의되어 있으므로 addEventListener를 호출한 주체인 HTML 엘리먼트를 가리키게 된다.

<br>

- 콜백 함수 내부의 this에 다른 값을 바인딩하는 방법

```javascript
var obj1 = {
  name: "obj1",
  func: function () {
    console.log(this.name);
  },
};

setTimeout(obj1.func.bind(obj1), 1000);

var obj2 = { name: "obj2" };
setTimeout(obj1.func.bind(obj2), 1500);
```

제어권을 넘겨받을 코드에서 this가 될 대상을 명시적으로 바인딩하면 원하는 값을 this로 정할 수 있다.

<br>

## 콜백 지옥

CPU의 계산에 의해 즉시 처리가 가능한 대부분의 코드는 <u>동기적인 코드</u>.  
사용자의 요청에 의해 특정 시간이 경과되기 전까지 어떤 함수의 실행을 **보류**, 사용자의 개입이 있을 때 **별도의 요청**, 응답이 왔을 때 비로소 어떤 함수를 실행하게 하는 **대기**는 모두 <u>비동기적인 코드</u>이다.

콜백 지옥은 들여쓰기가 깊어져 가독성이 떨어지는 것을 말한다.

### 해결법 \_최종.hell

익명의 콜백 함수를 모두 기명함수로 전환한다.

### 콜백 지옥 해결하기 (ES6+) \_최종\_진짜최종.hell

`Promise`, `Generator`, `async/await`로 해결하는 방법이 있다.
